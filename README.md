# GW Switch
Gateway switch - небольшой сервис для быстрого переключения маршрутов средствами маршрутизатора под управлением RouterOS.
Пользователь может самостоятельно зайти на страницу сервиса и выбрать нужный маршрут для его IP, например через VPN.


Есть 2 режима работы:

1. `route-tables` - создание правил маршрутизации для IP пользователя (режим по умолчанию)
2. `ip-lists` - добавление IP пользователя в нужный список фаервола (`address-list`)


Сборка и запуск приложения (для работы требуется минимум 11 версия java):

1. Делем копию репозитория в нужный каталог:
   * `git clone https://github.com/Haw41k/gw-switch.git`
2. В каталоге скачанного проекта используем mvnw (Maven Wrapper):
   * `mvnw spring-boot:run` для запуска сервиса без упаковки в JAR.
   * `mvnw package` для упаковки приложения в JAR. Последующий запуск `java -jar [путь к jar файлу]`. 
   * После сборки файлы будут находиться в каталоге `target`
3. Для работы потребуется конфигурационный файл, который нужно поместить в домашний каталог пользователя:
   * `[домашний каталог пользователя]/gw-switch/config/application.yml`

Пример конфигурационного файла:

```
gw-switch:
  # режим работы сервиса: ip-lists или route-tables, по умолчанию route-tables
  mode: route-tables
  
  # раз в сутки (00:00) чистит правила или списки, по умолчанию false.
  auto-clean: true
  
  # сервис помечает комментарием созданные им записи, используется при автоочистке.
  # по умолчанию значение "gw-switch"
  comment: gw-switch
  
  routers:
  - ip: 192.168.50.10
    user: api
    password: api
    gateways:
    # id - имя таблицы машрутизации
    # name - название в интерфейсе пользователя
    - id: rtab-1
      name: gw1
    - id: rtab-2
      name: gw2
```
Сервис по умолчанию запускается на `8080` порту, для изменения, в конфигурацию нужно добавить:
```
server:
  port: [порт]
```
Для работы с reverse proxy требуется передача http заголовка:
[X-Forwarded-For](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For)

## Рекомендации:
Для работы с API стоит создать отдельного пользователя и отдельную группу для него, с политиками: `read, write, api`

## Предупреждение:
Для работы с API используется незащищённое соединение на стандартный порт `8728`. 
В планах добавить возможность защищённого соединения.